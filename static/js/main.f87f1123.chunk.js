(this["webpackJsonpreact-around-auth"]=this["webpackJsonpreact-around-auth"]||[]).push([[0],{20:function(e,t,a){e.exports=a.p+"static/media/logo.8f7611ae.svg"},24:function(e,t,a){e.exports=a(35)},29:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(19),c=a.n(o),i=a(7),l=(a(29),a(22)),s=a(2),u=a(1),m=a(20),d=a.n(m);var f=function(e){return r.a.createElement("header",{className:"header"},r.a.createElement("img",{className:"header__logo",src:d.a,alt:"logo"}),r.a.createElement("p",{className:"header__email"},e.loggedIn?e.userEmail:""),r.a.createElement(i.b,{to:e.link.to,className:"header__link",onClick:e.onLogout?e.onLogout:null},e.link.description))},p=r.a.createContext({});var h=function(e){var t=r.a.useContext(p),a=t&&e.card.owner===t._id,n="card__delete-button ".concat(!a&&"card__delete-button_hidden"),o=t&&e.card.likes.includes(t._id),c="card__like-button ".concat(o&&"card__like-button_active"),i=e.card.likes.length;return r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{key:e.card.id,className:"card"},r.a.createElement("div",{className:"card__container"},r.a.createElement("button",{type:"button","aria-label":"Delete button",className:n,onClick:function(){e.onCardDelete(e.card)}}),r.a.createElement("div",{className:"card__image",style:{backgroundImage:"url(".concat(e.card.link,")")},onClick:function(){e.onCardClick(e.card)}}),r.a.createElement("div",{className:"card__text"},r.a.createElement("h2",{className:"card__title"},e.card.name),r.a.createElement("div",{className:"card__like-container"},r.a.createElement("button",{type:"button","aria-label":"Like button",className:c,onClick:function(){e.onCardLike(e.card)}}),r.a.createElement("p",{className:"card__like-counter"},i))))))};var _=function(e){var t=Object(n.useContext)(p);return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"profile"},r.a.createElement("div",{className:"profile__container"},r.a.createElement("div",{className:"profile__image-container"},r.a.createElement("button",{className:"profile__image-edit","aria-label":"Update profile image",onClick:e.onEditAvatar}),r.a.createElement("img",{className:"profile__image",src:t&&t.avatar,alt:"profile-picture"})),r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"profile__text"},r.a.createElement("h1",{className:"profile__title"},t&&t.name),r.a.createElement("p",{className:"profile__subtitle"},t&&t.about)),r.a.createElement("button",{className:"button profile__edit-button","aria-label":"Edit button",onClick:e.onEditProfile}))),r.a.createElement("button",{className:"button profile__add-button","aria-label":"Add button",onClick:e.onAddPlace})),r.a.createElement("section",{className:"cards"},r.a.createElement("ul",{className:"cards__grid"},e.cards.map((function(t,a){return r.a.createElement(h,{key:a,card:t,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete})})))))};var g=function(e){return r.a.createElement("footer",{className:"footer"},r.a.createElement("p",{className:"footer__copyright"},"\xa9 2020 | Linda Kovacs - Around The U.S."))};var b=function(e){var t=e.email,a=e.loggedIn,o=e.userEmail,c=e.setUserEmail,l=e.password,s=e.setPassword,m=e.handleLoginSubmit,d=e.setEmail,f=Object(u.g)();return Object(n.useEffect)((function(){a&&(f.push("/main"),c(t||o))})),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"auth__container"},r.a.createElement("h2",{className:"auth__title"},"Log in"),r.a.createElement("form",{action:"#",className:"auth",title:"Log in",onSubmit:m,to:"/main"},r.a.createElement("input",{className:"form__input-dark",placeholder:"Email",type:"email",required:!0,value:t,onChange:function(e){return d(e.target.value)}}),r.a.createElement("input",{className:"form__input-dark",placeholder:"Password",type:"password",required:!0,value:l,onChange:function(e){return s(e.target.value)}}),r.a.createElement("button",{type:"submit",className:"form__submit-button_dark",onClick:m},"Log in")),r.a.createElement(i.b,{className:"auth__link",to:"/signup"},"Not a member yet? Sign up here!")))};var E=function(e){var t=e.handleRegisterSubmit,a=e.history,o=e.email,c=e.setEmail,l=e.password,s=e.setPassword;return Object(n.useEffect)((function(){localStorage.getItem("token")&&a.push("/main")}),[a]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"auth__container"},r.a.createElement("h2",{className:"auth__title"},"Sign up"),r.a.createElement("form",{action:"#",className:"auth",title:"Sign up",onSubmit:t},r.a.createElement("input",{className:"form__input-dark",placeholder:"Email",type:"email",required:!0,value:o,onChange:function(e){return c(e.target.value)}}),r.a.createElement("input",{className:"form__input-dark",placeholder:"Password",type:"password",required:!0,value:l,onChange:function(e){return s(e.target.value)}}),r.a.createElement("button",{type:"submit",className:"form__submit-button_dark",onSubmit:t,to:"/main"},"Sign up")),r.a.createElement(i.b,{className:"auth__link",to:"/signin"},"Already a member? Log in here!")))};var v=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"form form__".concat(e.name," ").concat(e.isOpen?"form_visible":"")},r.a.createElement("form",{className:"form__container",name:"form__".concat(e.name),action:"#",noValidate:!0,onSubmit:e.onSubmit},r.a.createElement("h2",{className:"form__title"},e.title),e.children,r.a.createElement("button",{className:"form__submit-button",type:"submit"},e.buttonText),r.a.createElement("button",{className:"form__reset-button",type:"reset","aria-label":"Close button",onClick:e.onClose}))))};var k=function(e){var t=Object(n.useContext)(p),a=Object(n.useState)(""),o=Object(s.a)(a,2),c=o[0],i=o[1],l=Object(n.useState)(""),u=Object(s.a)(l,2),m=u[0],d=u[1];return r.a.useEffect((function(){i(t&&t.name),d(t&&t.about)}),[t]),r.a.createElement(v,{name:"edit-profile",title:"Edit profile",buttonText:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,about:m})}},r.a.createElement("fieldset",{className:"form__fields"},r.a.createElement("input",{type:"text",className:"form__input form__title",id:"name-input",name:"name",placeholder:"Name",minLength:"2",maxLength:"40",required:!0,value:c||"",onChange:function(e){i(e.target.value)}}),r.a.createElement("span",{className:"form__input-error",id:"name-input-error"}),r.a.createElement("input",{type:"text",className:"form__input form__subtitle",id:"job-input",name:"job",placeholder:"Job",minLength:"2",maxLength:"200",required:!0,value:m||"",onChange:function(e){d(e.target.value)}}),r.a.createElement("span",{className:"form__input-error",id:"job-input-error"})))};var C=function(e){var t=r.a.useRef("");return r.a.createElement(v,{name:"change-image",title:"Change profile picture",buttonText:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(a){a.preventDefault(),e.onUpdateAvatar({avatar:t})}},r.a.createElement("fieldset",{className:"form__fields"},r.a.createElement("input",{type:"url",className:"form__input form__image-link",id:"linkImage-input",name:"imageLink",placeholder:"Image link",minLength:"2",required:!0,ref:t}),r.a.createElement("span",{className:"form__input-error",id:"linkImage-input-error"})))};var N=function(e){var t=Object(n.useState)(""),a=Object(s.a)(t,2),o=a[0],c=a[1],i=Object(n.useState)(""),l=Object(s.a)(i,2),u=l[0],m=l[1];return r.a.createElement(v,{name:"add-card",title:"New place",buttonText:"Create",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlace({title:o,link:u})}},r.a.createElement("fieldset",{className:"form__fields"},r.a.createElement("input",{type:"text",className:"form__input form__card-title",id:"card-input",name:"title",placeholder:"Title",minLength:"1",maxLength:"30",required:!0,onChange:function(e){c(e.target.value)}}),r.a.createElement("span",{className:"form__input-error",id:"card-input-error"}),r.a.createElement("input",{type:"url",className:"form__input form__image-link",id:"link-input",name:"link",placeholder:"Image link",required:!0,onChange:function(e){m(e.target.value)}}),r.a.createElement("span",{className:"form__input-error",id:"link-input-error"})))};var j=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"form form__add-image"+(e.card?" form_visible":"")},r.a.createElement("div",{className:"form__open-image"},r.a.createElement("button",{className:"form__reset-button",type:"reset","aria-label":"Close button",onClick:e.onClose}),r.a.createElement("img",{className:"form__image",src:e.card?e.card.link:"#",alt:e.card?e.card.name:""}),r.a.createElement("p",{className:"form__image-title"},e.card?e.card.name:""))))},O=a(12),y=a(13),S=new(function(){function e(t){var a=t.baseUrl,n=t.headers;Object(O.a)(this,e),this._baseUrl=a,this._headers=n}return Object(y.a)(e,[{key:"getInitialCards",value:function(e){return fetch("".concat(this._baseUrl,"/cards"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(e.ok)return e.json()}))}},{key:"getUserInfo",value:function(e){return fetch("".concat(this._baseUrl,"/users/me"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(e.ok)return e.json()}))}},{key:"updateAvatar",value:function(e,t){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"PATCH",body:JSON.stringify({avatar:e})}).then((function(e){if(e.ok)return e.json()}))}},{key:"updateProfile",value:function(e,t){var a=e.name,n=e.about;return fetch("".concat(this._baseUrl,"/users/me"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"PATCH",body:JSON.stringify({name:a,about:n})}).then((function(e){if(e.ok)return e.json()}))}},{key:"addNewCard",value:function(e,t){return fetch("".concat(this._baseUrl,"/cards"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"POST",body:JSON.stringify({name:e.title,link:e.link})}).then((function(e){if(e.ok)return e.json()}))}},{key:"deleteCard",value:function(e,t){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"DELETE"})}},{key:"changeLikeCardStatus",value:function(e,t,a){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},method:t?"DELETE":"PUT"}).then((function(e){if(e.ok)return e.json()}))}}]),e}())({baseUrl:"http://localhost:3001"}),w=new(function(){function e(t){Object(O.a)(this,e),this.options=t}return Object(y.a)(e,[{key:"register",value:function(e,t){return fetch("".concat(this.options.baseUrl,"/signup"),{method:"POST",headers:{Acccept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){if(201===e.status)return e.json();throw new Error("409 - Unsuccessful registration")}))}},{key:"authorize",value:function(e,t){return fetch("".concat(this.options.baseUrl,"/signin"),{method:"POST",headers:{Acccept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return e.json()})).then((function(e){if(!e.message)return localStorage.setItem("token",e.token),e}))}},{key:"getContent",value:function(e){return fetch("".concat(this.options.baseUrl,"/users/me"),{method:"GET",headers:{Acccept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){return e.ok?e.json():Promise.reject("".concat(e.status," - ").concat(e.message))})).then((function(e){return e})).catch((function(e){return console.log(e)}))}}]),e}())({baseUrl:"http://localhost:3001"}),L=a(23);var U=function(e){var t=e.component,a=Object(L.a)(e,["component"]);return r.a.createElement(u.b,null,(function(){return a.loggedIn?r.a.createElement(t,a):r.a.createElement(u.a,{to:"./signin"})}))};var A=function(e){return r.a.createElement("section",{className:"form form__".concat(e.name," ").concat(e.isOpen?"form_visible":"")},r.a.createElement("div",{className:"form__container"},r.a.createElement("div",{className:"form__tooltip ".concat("success"===e.success?"form__tooltip_success":"form__tooltip_error")}),r.a.createElement("p",{className:"form__tooltip-message"},"success"===e.success?"Success! You have now been registered.":"Oops, something went wrong! Please try again."),r.a.createElement("button",{className:"form__reset-button",type:"reset","aria-label":"Close button",onClick:e.onClose})))};var P=Object(u.h)((function(){var e=Object(n.useState)(!1),t=Object(s.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)(!1),i=Object(s.a)(c,2),m=i[0],d=i[1],h=Object(n.useState)(!1),O=Object(s.a)(h,2),y=O[0],L=O[1],P=Object(n.useState)(!1),T=Object(s.a)(P,2),I=T[0],x=T[1],D=Object(n.useState)(null),z=Object(s.a)(D,2),B=z[0],q=z[1],J=Object(n.useState)(null),F=Object(s.a)(J,2),R=F[0],H=F[1],W=Object(n.useState)([]),G=Object(s.a)(W,2),K=G[0],M=G[1],V=Object(n.useState)(!1),Y=Object(s.a)(V,2),$=Y[0],Q=Y[1],X=Object(n.useState)(""),Z=Object(s.a)(X,2),ee=Z[0],te=Z[1],ae=Object(n.useState)(!1),ne=Object(s.a)(ae,2),re=ne[0],oe=ne[1],ce=Object(n.useState)(""),ie=Object(s.a)(ce,2),le=ie[0],se=ie[1],ue=Object(n.useState)(""),me=Object(s.a)(ue,2),de=me[0],fe=me[1],pe=Object(n.useState)(!1),he=Object(s.a)(pe,2),_e=he[0],ge=he[1],be=Object(n.useState)(localStorage.getItem("token")),Ee=Object(s.a)(be,2),ve=Ee[0],ke=Ee[1],Ce=Object(u.g)();function Ne(){d(!1),o(!1),L(!1),q(null),x(!1)}function je(e){oe(e),x(!0)}function Oe(){se(""),fe("")}function ye(){Q(!0)}function Se(){localStorage.removeItem("token"),Q(!1),Ce.push("/signin")}return Object(n.useEffect)((function(){ve?w.getContent(ve).then((function(e){Q(!0),te(e.data.email)})).catch((function(e){return console.log(e)})):Q(!1)}),[ve]),Object(n.useEffect)((function(){S.getUserInfo(ve).then((function(e){H(e.data),S.getInitialCards(ve).then((function(e){e.data&&M((function(t){return e.data}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))}),[ve]),r.a.createElement(p.Provider,{value:R},r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:"/signin"},r.a.createElement(f,{userEmail:ee,loggedIn:$,onLogout:Se,link:{description:"Sign up",to:"/signup"}}),r.a.createElement(b,{loggedIn:$,email:le,setEmail:se,password:de,setPassword:fe,userEmail:te,setUserEmail:te,handleLogin:ye,handleLoginSubmit:function(e){e.preventDefault(),w.authorize(le,de).then((function(e){if(e&&e.token)ke(e.token),localStorage.setItem("token",e.token),ye(),Ce.push("/main");else{if(Oe(),!le||!de)throw je("error"),new Error("400 - one or more of the fields were not provided");if(!e)throw je("error"),new Error("401 - the user with the specified email not found")}})).catch((function(e){return console.log(e.message)}))},onLogout:Se,isOpen:I,handleToolTip:je,success:re}),r.a.createElement(A,{isOpen:I,success:re,onClose:Ne,loggedIn:$})),r.a.createElement(u.b,{exact:!0,path:"/signup"},r.a.createElement(f,{userEmail:ee,loggedIn:$,link:{description:"Log in",to:"/signin"}}),r.a.createElement(E,{registered:_e,email:le,setEmail:se,password:de,setPassword:fe,handleRegisterSubmit:function(e){e.preventDefault(),w.register(le,de).then((function(e){if(e&&e._id)je("success");else if(je("error"),409===e.status)return Promise.reject(new Error("(Conflict) - User already taken"))})).then((function(e){return ge(!0),Ce.push("/signin"),e})).then(Oe).catch((function(e){return console.log(e)}))},setUserEmail:te,handleLogin:ye,handleToolTip:je}),r.a.createElement(A,{isOpen:I,success:re,onClose:Ne,loggedIn:$})),r.a.createElement(u.b,{exact:!0,path:"/"},$?r.a.createElement(u.a,{to:"/main"}):r.a.createElement(u.a,{to:"/signin"})),r.a.createElement(u.b,{path:"/main"},r.a.createElement(k,{isOpen:a,onClose:Ne,onUpdateUser:function(e){var t=e.name,a=e.about;S.updateProfile({name:t,about:a},ve).then((function(e){H(e.data)})).catch((function(e){return console.log(e)})),Ne()}}),r.a.createElement(C,{isOpen:y,onClose:Ne,onUpdateAvatar:function(e){var t=e.avatar;S.updateAvatar(t.current.value,ve).then((function(e){H(e.data)})).catch((function(e){return console.log(e)})),Ne()}}),r.a.createElement(N,{isOpen:m,onClose:Ne,onAddPlace:function(e){var t=e.title,a=e.link;S.addNewCard({title:t,link:a},ve).then((function(e){M([e.data].concat(Object(l.a)(K)))})).then((function(e){return Ne()})).catch((function(e){return console.log(e)}))}}),r.a.createElement(v,{name:"confirmation",title:"Are you sure?",isOpen:!1,onClose:Ne}),r.a.createElement(j,{onClose:Ne,card:B}),r.a.createElement(f,{loggedIn:$,userEmail:ee,link:{description:"Log out",to:"/signin"},onLogout:Se}),r.a.createElement(U,{path:"/main",loggedIn:$,component:_,onEditProfile:function(){o(!0)},onAddPlace:function(){d(!0)},onEditAvatar:function(){L(!0)},onCardClick:function(e){q(e)},onCardLike:function(e){var t=e.likes.includes(R._id);S.changeLikeCardStatus(e._id,t,ve).then((function(t){var a=K.map((function(a){return a._id===e._id?t:a}));M(a)})).catch((function(e){return console.log(e)}))},onCardDelete:function(e){S.deleteCard(e._id,ve).then((function(){M(K.filter((function(t){return t._id!==e._id})))})).then((function(e){return Ne()})).catch((function(e){return console.log(e)}))},onClose:Ne,isEditProfilePopupOpen:a,isAddPlacePopupOpen:m,isEditAvatarPopupOpen:y,selectedCard:B,cards:K})),r.a.createElement(u.a,{from:"*",to:"/"})),r.a.createElement(g,null))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(i.a,null,r.a.createElement(r.a.StrictMode,null,r.a.createElement(P,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.f87f1123.chunk.js.map